sequenceDiagram
    autonumber
    participant Client
    participant Gateway
    participant Orchestrator
    participant Queue
    participant Renderer
    participant DB as Postgres/pgvector
    participant Monitor as Monitoring

    Client->>Gateway: POST /intake (brief, objectives)
    Gateway->>Gateway: AuthN/Z (OIDC), rate limit
    Gateway->>Orchestrator: Create job (policy inputs)

    Orchestrator->>Orchestrator: Policy route (pii_level, budget_tier)
    Orchestrator->>Orchestrator: Run workflow (agents, evaluators)
    Orchestrator->>DB: Persist artefacts, evidence, metrics
    Orchestrator->>Queue: Enqueue render job
    Orchestrator->>Monitor: Emit telemetry (counters, histograms)

    Queue->>Renderer: Deliver render task
    Renderer->>DB: Store export metadata (PDF/SVG)
    Renderer->>Monitor: Emit telemetry

    Orchestrator-->>Gateway: Job accepted (status URL)
    Client->>Gateway: GET /status/{id}
    Gateway->>Orchestrator: Query status
    Orchestrator-->>Gateway: Status + links
    Gateway-->>Client: 200 OK (links to artefacts)
